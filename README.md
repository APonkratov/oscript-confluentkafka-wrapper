# OneScript Confluent.Kafka wrapper

[![Build status](https://ci.appveyor.com/api/projects/status/04fdarj9gfxw3il1/branch/main?svg=true)](https://ci.appveyor.com/project/APonkratov/oscript-confluentkafka-wrapper/branch/main)

## Поддержка Kafka для OneScript

## Установка

### Из хаба пакетов

`opm install ConfluentKafkaWrapper`

### Из релизов GitHub

1. Перейти на [страницу релизов]()
1. Скачать артефакт ConfluentKafkaWrapper-x.y.z.ospx
1. Установить с помощью opm: `opm install -f ConfluentKafkaWrapper-x.y.z.ospx`

### Из сборок AppVeyor

1. Перейти на страницу [последней сборки](https://ci.appveyor.com/project/APonkratov/oscript-confluentkafka-wrapper) или [истории сборок](https://ci.appveyor.com/project/APonkratov/oscript-confluentkafka-wrapper/history) и выбрать интересующую сборку
1. Перейти в раздел Artifacts
1. Скачать артефакт ConfluentKafkaWrapper-x.y.z.ospx
1. Установить с помощью opm: `opm install -f ConfluentKafkaWrapper-x.y.z.ospx`

## Использование

### Отправка сообщений

```bsl
#Использовать ConfluentKafkaWrapper

// Сообщение с ключом
КафкаПродюсер = Новый КафкаПродюсер("my-example-host.local");
КафкаПродюсер.Отправить("my-example-topic", "my-example-key", "my-important-message");

// Сообщение с ключом и заголовками
Заголовки = Новый Соответствие;
Заголовки.Вставить("Header1", "Value1");
Заголовки.Вставить("Header2", "Value2");

КафкаПродюсер.Отправить("my-example-topic", "my-example-key", "my-important-message", Заголовки);
```

### Чтение сообщений

```bsl
// Описание параметров консумера
Параметры = Новый Соответствие;
Параметры.Вставить("auto.offset.reset", "earliest");   
Параметры.Вставить("enable.auto.commit", "false");     
Параметры.Вставить("enable.auto.offset.store", "false"); 
Параметры.Вставить("enable.partition.eof", "true");

// Инициализация и подписка на топик
КафкаКонсумер = Новый КафкаКонсумер("my-exapmle-host.local", "my-group-id", Параметры);
КафкаКонсумер.Подписаться("my-example-topic");

// Чтение циклом до конца раздела
РазрешеноЧтение = Истина;

Пока РазрешеноЧтение Цикл
    
    РезультатЧтенияСообщения = КафкаКонсумер.Прочитать();

    Если РезультатЧтенияСообщения = Неопределено Тогда
        Сообщить("РезультатЧтенияСообщения = Неопределено");
        Продолжить;
    КонецЕсли;

    Если РезультатЧтенияСообщения.ЭтоКонецРаздела Тогда
        Сообщить("РезультатЧтенияСообщения.ЭтоКонецРаздела = Истина");
        Прервать;
    КонецЕсли;
    
    ТекстСообщения = СтрШаблон("Прочитано сообщение: Топик - %1, Раздел - %2, Смещение - %3, Сообщение.Ключ - %4, Сообщение.Значение - %5",
        РезультатЧтенияСообщения.Топик, РезультатЧтенияСообщения.Раздел, РезультатЧтенияСообщения.Смещение,
        РезультатЧтенияСообщения.Сообщение.Ключ, РезультатЧтенияСообщения.Сообщение.Значение);
    
    Сообщить(ТекстСообщения);
    
    // Обработка сообщения
    ...
    
    // Фиксация смещения
    КафкаКонсумер.ЗафиксироватьСмещение(РезультатЧтенияСообщения.Топик, РезультатЧтенияСообщения.Раздел, РезультатЧтенияСообщения.Смещение);
КонецЦикла;
```

## Список методов

Список методов и их описание будут доступны в каталоге [docs](docs)